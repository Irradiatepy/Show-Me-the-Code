<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>用 Python 生成随机的邀请码 | 始终</title>
  <meta name="author" content="Liam Huang">
  
  <meta name="description" content="Liam&#39;s Blog | Liam Huang&#39;s Blog | Liam | Huang | Python | LaTeX | C++ | Java | GRE | TOEFL">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <meta property="og:title" content="用 Python 生成随机的邀请码"/>
  <meta property="og:site_name" content="始终"/>

  <link rel="alternate" href="/atom.xml" title="始终" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!-- 尝试从 bdimg 获取 JQuery -->
  <script src="http://apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
  <!-- 如果获取失败，则载入本站的 JQuery -->
  <script type="text/javascript">
  //<![CDATA[
  if (typeof jQuery == 'undefined') {
    document.write(unescape("%3Cscript src='/js/jquery-2.0.3.min.js' type='text/javascript'%3E%3C/script%3E"));
  }
  // ]]>
  </script>
  <script type="text/javascript" src="http://tajs.qq.com/stats?sId=45037302" charset="UTF-8"></script>

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44836433-1', 'liam0205.me');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>


  <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</head>


<body>
  <div class="wrapper">
    <header id="header"><div class="title">
  <h1><a href="/">始终</a></h1>
  <a href="/">不忘初心</a>
</div>
<!--
<div>
<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
 <input style="width:60px;background-color:transparent;text-align:center; border-width:0px;border-top-style: none; border-right-style: none; border-left-style: none; border-bottom-style: none; "  type="search" name="q" id="search" autocomplete="off" autocorrect="off" autocapitalize="off" maxlength="20" placeholder="s" />
 <input type="hidden" name="q" value="site:liam0205.me">
</form>
</div>
-->
<nav class="nav">
  <ul>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/links">链接</a></li>
    
      <li><a href="/about">关于</a></li>
    
      <li><a href="http://c??????.??ollect.liam0205.me">文摘</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <time datetime="2015-05-07T13:34:23.000Z"><a href="/2015/05/07/generator-of-invitation-code-in-python/">2015 年 05 月 7 日</a></time>
    
    
  
    <h1 class="title">用 Python 生成随机的邀请码</h1>
  

  </header>
  
  <div class="entry">
    
      <p>在很多场合，我们都需要生成一系列固定长度的字符串，分发给用户，作为邀请码或者兑换码。</p>
<p>关于邀请码，最容易想到的特征有二：一是足够长，二是不具有规律性。这两个特征主要是为了防止用户伪造邀请码，简单来说，就是让用户「猜对」正确邀请码的可能性足够小。不过，作为邀请码来说，仅有这两个特征还不够。</p>
<p>邀请码并不是发放给用户就结束了，还涉及到验证的过程。用户在收到邀请码之后，将邀请码提交给系统。系统在收到提交之后，要在数据库里查询是否有匹配的记录。所以生成邀请码时除了要防止用户伪造，还要方便后期的校验。这就要求我们能够从邀请码中，经过简单的变换，提取出「主键」。</p>
<p>这篇文章我们讨论一下如何用 Python 生成随机的邀请码。</p>
<a id="more"></a>

<h2 id=" 产生随机数 ">产生随机数</h2>
<p>Python 有自带的随机库，其名为 <code>random</code>。<code>random</code> 库中的 <code>randint(inf, sup)</code> 函数可以在指定的范围内产生一个随机整数；<code>choice(sequence)</code> 可以在一个有序的类型中（比如 <code>list</code>、<code>tuple</code> 或 <code>string</code>）随机选取一个元素。</p>
<p>这里我们需要产生一个 15 位的随机串，可以包含数字和大小写字母。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="comment"># import random, string</span>

poolOfChars  = string.ascii_letters + string.digits
random_codes = <span class="keyword">lambda</span> x, y: <span class="string">''</span>.join([random.choice(x) <span class="keyword">for</span> i <span class="keyword">in</span> range(y)])

<span class="keyword">print</span> random_codes(poolOfChars, <span class="number">15</span>)
</pre></td></tr></table></figure>



<h2 id=" 填充空位 ">填充空位</h2>
<p>为了方便统计，主键通常是一个递增的整数序列。如果主键的值从 1 增加到 1000，那么主键的「（十进制）位数」就会从 1 增加到 4。对于邀请码来说，我们需要固定其总长度。反应到主键上，我们就需要固定主键的长度。最简单的办法，就是用 0 填充（pad）空位。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">LengthError</span><span class="params">(ValueError)</span>:</span>
   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, arg)</span>:</span>
      self.args = arg

<span class="function"><span class="keyword">def</span> <span class="title">pad_zero_to_left</span><span class="params">(inputNumString, totalLength)</span>:</span>
    <span class="string">'''
    takes inputNumString as input,
    pads zero to its left, and make it has the length totalLength
    1. calculates the length of inputNumString
    2. compares the length and totalLength
        2.1 if length &gt; totalLength, raise an error
        2.2 if length == totalLength, return directly
        2.3 if length &lt; totalLength, pads zeros to its left
    '''</span>
    lengthOfInput = len(inputNumString)
    <span class="keyword">if</span> lengthOfInput &gt; totalLength:
        <span class="keyword">raise</span> LengthError(<span class="string">"The length of input is greater than the total\ length."</span>)
    <span class="keyword">else</span>:
        <span class="keyword">return</span> <span class="string">'0'</span> * (totalLength - lengthOfInput) + inputNumString
</pre></td></tr></table></figure>



<h2 id=" 拼接 ">拼接</h2>
<p>至此，我们已经得到了主键和随机序列产生的方法，剩下的问题就是要拼接起来。拼接两个字符串很容易，但是我们在拼接完成之后，还要保证能够很容易地找到主键的部分。</p>
<p>为了达成这个目的，我们只需要在主键和随机串之间加上一个固定的字母，比如 <code>L</code>，作为标识符。</p>
<pre><code>bGH49U63p5zy3ULL0123
</code></pre><p>这样我们就知道，整个邀请码子串最后一个 <code>L</code> 之后，就是主键部分。我们有代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="function"><span class="keyword">def</span> <span class="title">invitation_code_generator</span><span class="params">(quantity, lengthOfRandom, LengthOfKey)</span>:</span>
    <span class="string">'''
    generate `quantity` invitation codes
    '''</span>
    placeHoldChar = <span class="string">"L"</span>
    <span class="keyword">for</span> index <span class="keyword">in</span> range(quantity):
        tempString = <span class="string"></span>
        <span class="keyword">try</span>:
            <span class="keyword">yield</span> random_codes(poolOfChars, lengthOfRandom) + placeHoldChar + \
                pad_zero_to_left(str(index), LengthOfKey)
        <span class="keyword">except</span> LengthError:
            <span class="keyword">print</span> <span class="string">"Index exceeds the length of master key."</span>

<span class="keyword">for</span> invitationCode <span class="keyword">in</span> invitation_code_generator(<span class="number">200</span>, <span class="number">15</span>, <span class="number">4</span>):
    <span class="keyword">print</span> invitationCode
</pre></td></tr></table></figure>



<p>这样，我们就生成了 200 个邀请码。其中随机串长度为 15，主键长度为 4，分隔符为字母 <code>L</code>。</p>

   

      
  
  
  </footer>
</article>




<div class="clearfix"></div>
<script src="//dn-lbstatics.qbox.me/lbservice/busuanzi/2.0/busuanzi.mini.js"/>
</script>
</footer>
  <script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>



<script type="text/javascript">
  var duoshuoQuery = { short_name: 'cnliam' };
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>


</body>
</html>